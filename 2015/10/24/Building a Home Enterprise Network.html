<!DOCTYPE HTML>
<html>
		<head>
    	<title>Building a Home Enterprise Network Part 1</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width"> 
		<link href="/css/tufte.css" rel="stylesheet"  />
		<link href="/css/tufte-custom.css" rel="stylesheet" />
		<link href="/css/tufte-syntax.css" rel="stylesheet" />
		<link href="http://blog.jeremy.tavan.com/feed.xml" rel="alternate" type="application/rss+xml" title="Clutching at Security Blankets" />
	</head>	

<body>
			<a href="/"><h1>Clutching at Security Blankets</h1></a>
		<p class="subtitle">Lessons learned while working in Information Security.</p>
		<span class="codedirection">moc.navat@ymerej</span>
		<hr/>
		<section>
			<h2>Building a Home Enterprise Network Part 1</h2><br/>
			24 October 2015
		</section>
		<p>I decided, during my recent SANS overview course’s day on defensive network infrastructure, that I really don’t know enough about networking. Sure, I had all the basics - I understood the basics of the <a href="https://en.wikipedia.org/wiki/OSI_model">OSI model</a>, setting up computers to talk to each other over TCP/IP, <a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">CIDR</a> notation, how to crimp a functional RJ45 patch cable, &amp;c. but I really had never had to learn about how enterprise networks go together. My employer has a large department to take care of that - I just have to use the thing. But I’m not comfortable just using the thing. So I decided to teach myself networking and network security by building the most complicated home network in California.<label for="sn-7cc4ei06l7kf" class="margin-toggle sidenote-number"></label>
<input type="checkbox" id="sn-7cc4ei06l7kf" class="margin-toggle" /><span class="sidenote">This may be an exaggeration, but probably not by a whole lot.</span></p>

<p>I’m not going to put a complete network diagram in this blog posting,<label for="sn-91fcvz7tasi" class="margin-toggle sidenote-number"></label>
<input type="checkbox" id="sn-91fcvz7tasi" class="margin-toggle" /><span class="sidenote">If you’re interested in the details, get in contact with me and I’d be happy to discuss it. </span> but let’s go over some of the most interesting features of what I’ve done so far and what’s planned.</p>

<h3 id="virtualization-server">Virtualization Server</h3>
<p>One of the first things I bought was a virtualization server, because I knew that I wanted to pull most of the services running on my network off of the desktop computers currently running them and place them on a power-efficient, modern virtualization system. I’m running ProxMox 4 as the base management system, and have a number of KVM virtual machines and LXC containers in place and planned. Unfortunately, I’m currently experiencing severe performance issues between the LXC containers and the outside network via the virtio network drivers and an Open vSwitch bridge on the host.<label for="sn-azz51wa8poy" class="margin-toggle sidenote-number"></label>
<input type="checkbox" id="sn-azz51wa8poy" class="margin-toggle" /><span class="sidenote">Does anyone know what causes these &lt;1kB/s throughputs? Please contact me!</span></p>

<p>The server itself is a mini-ITX motherboard with one of the new Intel Xeon 1540D chips on board. 8 cores, 16 threads, and 45W TDP. Talks to &gt;64GB of DDR4, has piles of SATA ports and five network ports (two 1Gig, two 10Gig copper, one IPMI). Slapped that plus a couple ZFS mirrored 1TB SSDs in a cute little 2U rackmount box from <a href="http://www.plinkusa.com/">PLinkUSA</a> and I have most all the compute I need for services on the network.</p>

<h3 id="managed-switch">Managed Switch</h3>
<p>Netgear sell a 24-port managed gigabit switch with two copper and two SFP+ 10GigE ports for $500. Wat. I’m pretty impressed with the thing so far - enough so that I plan on buying a second one for my media room and connecting the two via fiber for a single integrated management interface. Plus, I have configured one of the copper 10Gig ports as a mirror port for monitoring and the other serves as my virtualization box’s trunk port. Channel bonding? Sure - it does that. I have my NAS plugged in via four channel-bonded 1Gig ports. That took all of about 2 minutes to set up.</p>

<h3 id="virtual-machine-router">Virtual Machine Router</h3>
<p>My router is a KVM virtual machine running <a href="http://www.pfsense.org/">pfSense</a>. I’d never played with pfSense before, but I’m really impressed. It’s like you took all those web GUIs from home routers and configured them for every feature you could possibly ever want and removed all the extraneous graphical crap. It even has a package management system for adding more features - installing NUT for talking to my UPS’s SNMP interface was about a 5 minute job. The only real issue I have with pfSense is that the firewall rules are basically backwards from what I’m used to. You configure rules based on the network that is ORIGINATING the traffic, not based on what’s allowed to enter the destination network. So much confusion at first, but in their defense they DO document that somewhat.</p>

<h3 id="vlans">VLANs</h3>
<p>Oh yes, we do VLANs in this household. Currently running separate VLANs for storage, PCs, printers, IoT devices, media devices, infrastructure management interfaces, external-facing services, security cameras … It’s a pain to have to buy and configure a bunch of smart-ish switches<label for="sn-a4r043ofbpzt" class="margin-toggle sidenote-number"></label>
<input type="checkbox" id="sn-a4r043ofbpzt" class="margin-toggle" /><span class="sidenote">Do not buy the Netgear GS108PEv3 (or earlier versions of the same thing). It’s a garbage pocket switch that claims to support proper 802.1q but doesn’t fully. You can’t (as far as I’ve been able to determine) set it up for a management VLAN.</span> but I like the segmentation and the control that this gives me with firewalls over what talks to what. It should also make detection of bad easier.</p>

<h3 id="commercial-style-waps">Commercial-style WAPs</h3>
<p>One of the secondary motivations for this project was that I was tired of consumer routers that have to be replaced annually or malfunction just enough to annoy but not enough to trigger replacement (like my old Asus router that needed weekly reboots to get the wireless working again). Once I implemented VLAN tagging, though, I realized that I really needed a more capable wireless access point that could handle it. I picked up an Engenius smoke-detector-style WAP with all the appropriate features, and while I’m not pleased with the performance of its management interface, it does appear to do the job, at least on the 2.4GHz band.  It does allow me to have multple SSIDs, each with its own authentication and VLAN tags. One issue encountered and overcome is that the WAP had a “rapid handoff” mode that caused it to drop connections below a certain signal strength threshold in order to encourage devices to connect to a closer WAP. That doesn’t work well if you only have the one WAP! To do: implement proper 802.1X RADIUS authentication.</p>

<h3 id="network-monitoring">Network Monitoring</h3>
<p>I’ve got a VM running a wide range of network monitoring tools, though at the moment they’re all just barely at the “spun up” state, and I haven’t yet configured all the alerting/active response stuff that I want. Bro for packet/protocol inspection, Snort monitoring, &amp;c.<label for="sn-72c11m8pmfj4" class="margin-toggle sidenote-number"></label>
<input type="checkbox" id="sn-72c11m8pmfj4" class="margin-toggle" /><span class="sidenote">$30/year for the Snort VRT rule updates for home users? Stupid cheap. </span></p>

	<p>This article is tagged: <span class="taglist">
	
		<a href="/tag/network">network</a>
	
		<a href="/tag/education">education</a>
	
	</span></p>
		
</body>
</html>
